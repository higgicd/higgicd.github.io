{
  "hash": "6d2b5c582adc40b5b4968ea98d53d59a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Slow Transit: Finch West\"\ndate: \"2025-12-01\"\ncategories: [code, analysis]\nimage: \"banner.jpg\"\nbibliography: references.bib\ncode-annotations: hover\n---\n\nThe excitement is palpable – new rapid transit is opening in Toronto. After 7 years of construction, the \\$3.6 billion Finch West LRT will open its doors on December 7, beating out another line just to the south who shall not be named.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![ChatGPT's \"It's Happening meme with the Finch West LRT\"](./img/its_happening.jpg){#fig-its_happening width=75%}\n:::\n:::\n\n\nThat excitement for new *rapid* transit died a little bit when [early looks at the new General Transit Feed Specification (GTFS) schedules posted by the TTC](https://stevemunro.ca/2025/11/28/6-finch-west-schedules-travel-times-speeds/) this past weekend revealed that the scheduled travel times along the line correspond to an average speed of 13.53kph or about a 45 minute trip from end to end. Per Steve Munro's reporting, this speed is actually slower than the Finch bus that the LRT is supposed to replace, and certainly slower than the \\~18kph and 34 minute travel time from [milestone testing](https://www.metrolinx.com/en/discover/finch-west-lrt-year-in-review).\n\nNow, who knows why these posted GTFS travel times differ so widely from the milestone travel times where vehicles were reaching up to 60kph in some segments. GTFS schedules are a bit opaque in that they reflect static travel times that may or may not be optimistic/pessimistic. Previous work in Toronto has already shown that these schedules can differ quite dramatically from observed vehicle movements captured by GTFS Realtime data [@wessel2019].\n\nPerhaps they are overly conservative for a soft opening. Perhaps they are just true based on how the TTC feels comfortable operating the line. Perhaps they are purposefully slow to help make a point about signal priority and we are taking the bait. I suppose all we can do is see how things settle in when proper revenue service begins.\n\nIn any case, while travel times are one thing, naturally I wanted to see the impact on accessibility – the potential to reach things using the transportation network – relative to the original bus service and considering these posted and potential speeds. See my previous post on [Accessibility Analysis in Toronto](https://higgicd.github.io/posts/accessibility_analysis/) for some background on that concept and a full walk through on obtaining data and running an analysis.\n\nAs someone currently writing a book on accessibility analysis with R, the opening of Finch West LRT presents a fun opportunity to explore routing, accessibility, and some simple GTFS editing to speed up a service. \n\n## Setup\n\nLet's pick up where the previous post left off and set up our environment. First, allocate some memory to Java for $R^5$ and {r5r} to work and load a few key packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# allocate java memory for r5r\noptions(java.parameters = \"-Xmx8G\")\n\n# load base packages\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(tmap)\n```\n:::\n\n\n### Download Data\n\nSecond, we need a few key data inputs to run an accessibility analysis around the Finch West LRT, including an OpenStreetMap (OSM) road network, GTFS transit schedules, and data on the origins and destinations for the analysis. We can save our major data downloads to a new `./data` folder:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_path <- fs::dir_create(\"./data\")\n```\n:::\n\n\nNow on to the OSM data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nosmextract::oe_download(\n  file_url = \"http://download.openstreetmap.fr/extracts/north-america/canada/ontario/golden_horseshoe-latest.osm.pbf\",\n  provider = \"openstreetmap_fr\",\n  download_directory = data_path\n)\n```\n:::\n\n\nFor GTFS feeds, I will download two different schedule files. One for November-December 2018 with the Finch bus service before construction started and the newest GTFS file from the TTC with the new Finch LRT, both from [transit.land](https://www.transit.land). You would need an API key to download these yourself (free for hobbyist use), which is defined here:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntransit_land_api_key <- \"your_api_key_here\" \n```\n:::\n\n\nNext, set up a named list with the GTFS feed SHA1 IDs:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngtfs_list <- list(\n  \"ttc_2018\" = \"91d9cf49675be7b18d921748a573e4f7289e8df6\",\n  \"ttc_2025\" = \"8574169d5cc56d5563f492102d4197549820ad5d\"\n)\n```\n:::\n\n\nFinally, use an iterative `walk()` from {purrr} to download the feeds:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\npurrr::iwalk(gtfs_list,\n             ~ httr2::req_perform(\n               req = httr2::request(\n                 paste0(\n                   \"https://transit.land/api/v2/rest/feed_versions/\",\n                   .x,\n                   \"/download?apikey=\",\n                   transit_land_api_key\n                 )\n               ),\n               path = fs::path(data_path, paste0(.y, \".zip\"))\n             ))\n```\n:::\n\n\nFor origin data I will use 2021 Census Dissemination Blocks (DBs). We need to set up our {cancensus} API key and cache folder:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncancensus::set_cancensus_api_key(\"<your API key>\")\ncancensus::set_cancensus_cache_path(data_path)\n```\n:::\n\n\nNow we can get them using this code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncensus_data_db <- cancensus::get_census(\n    dataset = 'CA21', # <1>\n    regions = list(CSD = c(\"3520005\")), # <2>\n    level = 'DB', # <3>\n    geo_format = \"sf\", # <4>\n    use_cache = TRUE) |> \n  janitor::clean_names() |> # <5>\n  st_transform(crs = 26917) |> # <6>\n  mutate(population_density = population / shape_area)\n```\n:::\n\n\nFor the destinations, let's keep it simple and use employment counts captured by the 2016 Transportation Tomorrow Survey (TTS) using the {TTS2016R} package (which you can install from the [github repository](https://github.com/soukhova/TTS2016R) using {remotes}):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntts_tazs <- TTS2016R::ggh_taz |> \n  janitor::clean_names() |>\n  sf::st_transform(crs = 26917) |> \n  mutate(id = gta06)\n```\n:::\n\n\nFinally, to aid with mapping, let's get the most recent existing and future rapid transit lines shapefile from Metrolinx:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmetrolinx_url <- \"https://assets.metrolinx.com/raw/upload/v1693928524/Documents/Metrolinx/Open%20Data/September%205%2C%202023%20-%20FRTN/GIS_Data_-_Future_Transit_Network_-_2023-05-12.zip\"\n\nutils::download.file(\n  metrolinx_url,\n  destfile = fs::path(data_path, \"metrolinx_rt.zip\")\n  )\n\nzip::unzip(\n  zipfile = fs::path(data_path, \"metrolinx_rt.zip\"),\n  exdir = data_path\n  )\n```\n:::\n\n\nThese data can now be read in as {sf} objects and we can extract the existing rapid transit lines and the Line 6 Finch West LRT:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrt_lines <- st_read(\"./data/RTP_TRANSIT_NETWORK.shp\") |> \n  st_transform(crs = 26917) |> \n  janitor::clean_names()\n  \nrt_stops <- st_read(\"./data/RTP_POINTS.shp\") |> \n  st_transform(crs = 26917) |> \n  janitor::clean_names()\n\nfwlrt_line <- rt_lines |> \n  filter(name == \"Finch West LRT\")\n\nfwlrt_stops <- rt_stops |> \n  filter(name == \"Finch West LRT\")\n\nexisting_rt <- rt_lines |>\n  filter(\n    status == \"Existing\",\n    technology == \"Subway\" | str_starts(technology, \"GO\")\n    )\n```\n:::\n\n\nOK, let's see what we are working with by making a map of population counts around the Finch West LRT:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nfwlrt_line_buffer <- fwlrt_line |> \n  st_buffer(dist = 1000)\n\ncensus_data_db_fwlrt <- census_data_db |> \n  mutate(orig_area = st_area(geometry)) |> \n  st_intersection(fwlrt_line_buffer) |> \n  mutate(\n    id = geo_uid, \n    new_area = st_area(geometry),\n    area_ratio = new_area/orig_area,\n    aw_population = population * area_ratio)\n\ntm_shape(census_data_db, bbox = fwlrt_line_buffer) + tm_polygons(col = \"grey99\", fill = \"grey95\") +\n  tm_shape(census_data_db_fwlrt) +\n  tm_fill(\n    fill = \"aw_population\",\n    fill.scale = tm_scale_intervals(\n      n = 10,\n      style = \"jenks\",\n      values = \"viridis\"\n    ),\n    fill_alpha = .85,\n    fill.legend = tm_legend(\n      title = \"population count\",\n      frame = FALSE\n    )\n  ) +\n  tm_shape(existing_rt) + tm_lines(col = \"grey35\", lwd = 4) +\n  tm_shape(fwlrt_line) + tm_lines(col = \"grey\", lwd = 4) +\n  tm_shape(fwlrt_stops) + tm_dots(size = .5, fill = \"grey\") +\n  tm_shape(fwlrt_stops) + tm_dots(size = .15, fill = \"white\")\n```\n\n::: {.cell-output-display}\n![Population Counts (2021) for DAs in the City of Toronto](index_files/figure-html/fig-pop_density-1.png){#fig-pop_density width=672}\n:::\n:::\n\n\n### Build Network\n\nCopy the OSM and GTFS data to a new `ttc_prepost` folder to store our $R^5$ network:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nttc_prepost_network_path <- fs::dir_create(\"./r5_networks/ttc_prepost\")\n\nfs::file_copy(\n  path = fs::path(data_path, \"openstreetmap_fr_golden_horseshoe-latest.osm.pbf\"),\n  new_path = ttc_prepost_network_path,\n  overwrite = TRUE\n)\n\nfs::file_copy(\n  path = fs::path(data_path, \"ttc_2018.zip\"),\n  new_path = ttc_prepost_network_path,\n  overwrite = TRUE\n)\n\nfs::file_copy(\n  path = fs::path(data_path, \"ttc_2025.zip\"),\n  new_path = ttc_prepost_network_path,\n  overwrite = TRUE\n)\n```\n:::\n\n\nThen build the network using {r5r}:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nttc_prepost_network <- r5r::build_network(data_path = ttc_prepost_network_path)\n```\n:::\n\n\n## Pre- and Post-Accessibility\n### Travel Times\n\nHow is Line 6 performing in terms of travel times? With the network built, let's try some simple routes between Humber College and Finch West subway station at 8:00:00 AM on a typical Tuesday in December to see the difference in travel times from 2018 versus 2025 with the Finch West LRT open:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nhumber_point <- fwlrt_stops |> \n  filter(location_n == \"Humber College\") |> \n  mutate(id = 1) |> \n  st_transform(crs = 4326)\n\nfinch_west_point <- fwlrt_stops |> \n  filter(location_n == \"Finch West\") |> \n  mutate(id = 2) |> \n  st_transform(crs = 4326)\n\nroute_pre_eb <- r5r::detailed_itineraries(\n  r5r_network = ttc_prepost_network,\n  origins = humber_point,\n  destinations = finch_west_point,\n  mode = \"transit\",\n  departure_datetime = ymd_hms(\"2018-12-11 08:00:00\"),\n  shortest_path = FALSE\n) |> filter(option == 1) |> \n  mutate(scenario = \"pre\", route = \"36\", direction = \"eastbound\")\n\n# 55405 is Finch West route 36 in routes.txt\n\nroute_pre_wb <- r5r::detailed_itineraries(\n  r5r_network = ttc_prepost_network,\n  origins = finch_west_point,\n  destinations = humber_point,\n  mode = \"transit\",\n  departure_datetime = ymd_hms(\"2018-12-11 08:00:00\"),\n  shortest_path = FALSE\n) |> filter(option == 1) |> \n  mutate(scenario = \"pre\", route = \"36\", direction = \"westbound\")\n\n\nroute_post_eb <- r5r::detailed_itineraries(\n  r5r_network = ttc_prepost_network,\n  origins = humber_point,\n  destinations = finch_west_point,\n  mode = \"transit\",\n  departure_datetime = ymd_hms(\"2025-12-09 08:00:00\"),\n  shortest_path = FALSE\n) |> \n  mutate(scenario = \"post\", direction = \"eastbound\")\n\nroute_post_wb <- r5r::detailed_itineraries(\n  r5r_network = ttc_prepost_network,\n  origins = finch_west_point,\n  destinations = humber_point,\n  mode = \"transit\",\n  departure_datetime = ymd_hms(\"2025-12-09 08:00:00\"),\n  shortest_path = FALSE\n) |> \n  mutate(scenario = \"post\", direction = \"westbound\")\n```\n:::\n\n\nWith the routes calculated, lets examine the eastbound and westbound travel times pre-construction and now post-construction with Line 6 (@tbl-routes):\n\n\n::: {#tbl-routes .cell tbl-cap='Route-based Travel Times between Humber and Finch West'}\n\n```{.r .cell-code  code-fold=\"true\"}\nroute_pre_eb |> \n  bind_rows(route_pre_wb, route_post_eb, route_post_wb) |> \n  filter(mode != \"WALK\") |> \n  st_drop_geometry() |> \n  select(scenario, direction, mode, route, segment_duration) |> \n  gt::gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"mfcwiwvfbq\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#mfcwiwvfbq table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#mfcwiwvfbq thead, #mfcwiwvfbq tbody, #mfcwiwvfbq tfoot, #mfcwiwvfbq tr, #mfcwiwvfbq td, #mfcwiwvfbq th {\n  border-style: none;\n}\n\n#mfcwiwvfbq p {\n  margin: 0;\n  padding: 0;\n}\n\n#mfcwiwvfbq .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#mfcwiwvfbq .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#mfcwiwvfbq .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#mfcwiwvfbq .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#mfcwiwvfbq .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#mfcwiwvfbq .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mfcwiwvfbq .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#mfcwiwvfbq .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#mfcwiwvfbq .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#mfcwiwvfbq .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#mfcwiwvfbq .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#mfcwiwvfbq .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#mfcwiwvfbq .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#mfcwiwvfbq .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#mfcwiwvfbq .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#mfcwiwvfbq .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#mfcwiwvfbq .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#mfcwiwvfbq .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#mfcwiwvfbq .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mfcwiwvfbq .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#mfcwiwvfbq .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#mfcwiwvfbq .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#mfcwiwvfbq .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mfcwiwvfbq .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#mfcwiwvfbq .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#mfcwiwvfbq .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mfcwiwvfbq .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mfcwiwvfbq .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#mfcwiwvfbq .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mfcwiwvfbq .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#mfcwiwvfbq .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mfcwiwvfbq .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#mfcwiwvfbq .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mfcwiwvfbq .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#mfcwiwvfbq .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mfcwiwvfbq .gt_left {\n  text-align: left;\n}\n\n#mfcwiwvfbq .gt_center {\n  text-align: center;\n}\n\n#mfcwiwvfbq .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#mfcwiwvfbq .gt_font_normal {\n  font-weight: normal;\n}\n\n#mfcwiwvfbq .gt_font_bold {\n  font-weight: bold;\n}\n\n#mfcwiwvfbq .gt_font_italic {\n  font-style: italic;\n}\n\n#mfcwiwvfbq .gt_super {\n  font-size: 65%;\n}\n\n#mfcwiwvfbq .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#mfcwiwvfbq .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#mfcwiwvfbq .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#mfcwiwvfbq .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#mfcwiwvfbq .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#mfcwiwvfbq .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#mfcwiwvfbq .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#mfcwiwvfbq .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#mfcwiwvfbq div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"scenario\">scenario</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"direction\">direction</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"mode\">mode</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"route\">route</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"segment_duration\">segment_duration</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"scenario\" class=\"gt_row gt_left\">pre</td>\n<td headers=\"direction\" class=\"gt_row gt_left\">eastbound</td>\n<td headers=\"mode\" class=\"gt_row gt_left\">BUS</td>\n<td headers=\"route\" class=\"gt_row gt_right\">36</td>\n<td headers=\"segment_duration\" class=\"gt_row gt_right\">44.8</td></tr>\n    <tr><td headers=\"scenario\" class=\"gt_row gt_left\">pre</td>\n<td headers=\"direction\" class=\"gt_row gt_left\">westbound</td>\n<td headers=\"mode\" class=\"gt_row gt_left\">BUS</td>\n<td headers=\"route\" class=\"gt_row gt_right\">36</td>\n<td headers=\"segment_duration\" class=\"gt_row gt_right\">40.3</td></tr>\n    <tr><td headers=\"scenario\" class=\"gt_row gt_left\">post</td>\n<td headers=\"direction\" class=\"gt_row gt_left\">eastbound</td>\n<td headers=\"mode\" class=\"gt_row gt_left\">TRAM</td>\n<td headers=\"route\" class=\"gt_row gt_right\">6</td>\n<td headers=\"segment_duration\" class=\"gt_row gt_right\">46.0</td></tr>\n    <tr><td headers=\"scenario\" class=\"gt_row gt_left\">post</td>\n<td headers=\"direction\" class=\"gt_row gt_left\">westbound</td>\n<td headers=\"mode\" class=\"gt_row gt_left\">TRAM</td>\n<td headers=\"route\" class=\"gt_row gt_right\">6</td>\n<td headers=\"segment_duration\" class=\"gt_row gt_right\">46.0</td></tr>\n  </tbody>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nBased on this, it does look like the LRT is scheduled to take 46 minutes end-to-end for this trip, which is a little bit more than the scheduled travel time for the 36 Finch West bus in 2018 (these estimates reflect the in-vehicle time based on scheduled service levels and omit the walking time and wait time that might be required between departing at 8AM and when the first bus arrives).\n\n### Accessibility Analysis\n\nAccessibility analysis can give us a better idea of how these travel times might be impacting the potential to reach destinations using the LRT. Let's examine any differences across the pre-construction and now with the LRT in the network. I will measure accessibility as the number of jobs that can be reached using transit with the same log-logistic impedance function from [my previous post](https://higgicd.github.io/posts/accessibility_analysis/). This impedance function is calibrated to commuting flows by transit and places less weight on destinations that are farther away. \n\nRemember that {r5r} does take service frequency into account in these calculations by running the travel time matrix over a time window and taking the median travel time [see vignette](https://ipeagit.github.io/r5r/articles/time_window.html). To capture service frequency, I will set this time window to 60 minutes so that we analyze access over the 8:00 AM to 9:00 AM time frame.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ntts_jobs <- tts_tazs |> \n  st_drop_geometry() |> \n  select(id, jobs)\n\nlog_logistic_f <- function(t_ij, med_tau, beta) {\n  1 / (1 + (t_ij / med_tau)^beta)\n}\n\naccess_pre <- r5r::travel_time_matrix(\n  r5r_network = ttc_prepost_network,\n  origins = census_data_db_fwlrt |> st_centroid() |> st_transform(crs = 4326),\n  destinations = tts_tazs |> st_centroid() |> st_transform(crs = 4326),\n  mode = \"transit\",\n  departure_datetime = ymd_hms(\"2018-12-11 08:00:00\"),\n  time_window = 60\n) |>\n  left_join(tts_jobs, by = c(\"to_id\" = \"id\")) |>\n  mutate(weighted_jobs = jobs * log_logistic_f(\n    t_ij = travel_time_p50,\n    med_tau = 49,\n    beta = 4.4856\n  )) |>\n  group_by(from_id) |>\n  summarize(access = sum(weighted_jobs)) |>\n  rename(access_pre = access)\n\naccess_post <- r5r::travel_time_matrix(\n  r5r_network = ttc_prepost_network,\n  origins = census_data_db_fwlrt |> st_centroid() |> st_transform(crs = 4326),\n  destinations = tts_tazs |> st_centroid() |> st_transform(crs = 4326),\n  mode = \"transit\",\n  departure_datetime = ymd_hms(\"2025-12-09 08:00:00\"),\n  time_window = 60\n) |> \n  left_join(tts_jobs, by = c(\"to_id\" = \"id\")) |>\n  mutate(weighted_jobs = jobs * log_logistic_f(\n    t_ij = travel_time_p50,\n    med_tau = 49,\n    beta = 4.4856\n  )) |>\n  group_by(from_id) |>\n  summarize(access = sum(weighted_jobs)) |>\n  rename(access_post = access)\n```\n:::\n\n\nNow join the results back to the DBs and calculate the change in access across the pre- and post-accessibility scenarios:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncensus_data_db_fwlrt_access <- census_data_db_fwlrt |>\n  left_join(access_pre, by = c(\"id\" = \"from_id\")) |>\n  left_join(access_post, by = c(\"id\" = \"from_id\")) |>\n  mutate(access_diff_prepost = ((access_post - access_pre) / access_pre) * 100)\n```\n:::\n\n\nLet's examine the results changes spatially:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ntm_shape(census_data_db, bbox = fwlrt_line_buffer) + tm_polygons(col = \"grey99\", fill = \"grey95\") +\n  tm_shape(census_data_db_fwlrt_access) +\n  tm_fill(\n    fill = \"access_diff_prepost\",\n    fill.scale = tm_scale_intervals(\n      n = 11,\n      style = \"fisher\",\n      midpoint = 0,\n      values = \"-brewer.rd_bu\"\n    ),\n    fill.legend = tm_legend(\n      title = \"accessibility \\nchange (%)\",\n      frame = FALSE #\n    )\n  ) +\n  tm_shape(existing_rt) + tm_lines(col = \"grey35\", lwd = 4) +\n  tm_shape(fwlrt_line) + tm_lines(col = \"grey\", lwd = 4) +\n  tm_shape(fwlrt_stops) + tm_dots(size = .5, fill = \"grey\") +\n  tm_shape(fwlrt_stops) + tm_dots(size = .15, fill = \"white\") \n```\n\n::: {.cell-output-display}\n![Change in accessibility from late 2018 to 2025](index_files/figure-html/fig-prepost_access_change-1.png){#fig-prepost_access_change width=672}\n:::\n:::\n\n\nInteresting! The results in @fig-prepost_access_change show quite a few DBs gained in access by up to about 17\\% with the LRT relative to the network in late 2018. However, quite a few DBs also lose access with the percentage change reaching up to about -21\\%. This is obviously not a great result -- the addition of \"rapid transit\" along the corridor, ostensibly to replace a bus that is often bogged down in traffic, does not stand out as an accessibility \"home run\" with strictly positive gains in this analysis.\n\nNevertheless, I will caution that this is comparing the transit _networks_ across 2018 and now late 2025. There could be additional service changes elsewhere in the network that may be contributing to these results, such as slow zones on the subway. Moreover, these are scheduled services and the travel times along particular routes may be adjusted over GTFS releases to better reflect observed travel times. \n\n## Faster Finch\n\nFor what it is worth, what if the Finch West LRT was operating faster? Again, the milestone testing had the travel time along the line down to about 24 minutes, or an average travel speed of 18kph. How would the accessibility results change if Line 6 was operating at this speed? Faster speeds generally mean more things should be accessible within a given travel time. We can test this by manipulating the GTFS files to make the LRT faster and building a new network for routing. \n\nFirst, we will create a new network folder (with `_ff` for \"faster Finch\") and copy over the OSM data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nttc_2025_ff_path <- fs::dir_create(\"./r5_networks/ttc_2025_ff\")\n\nfs::file_copy(\n  path = fs::path(data_path, \"openstreetmap_fr_golden_horseshoe-latest.osm.pbf\"),\n  new_path = ttc_2025_ff_path,\n  overwrite = TRUE\n)\n```\n:::\n\n\nOne way to speed up a service is to use the {gtfstools} package, which as limited functions for editing GTFS files. One of these functions is `set_trip_speed()`, which changes the speeds of the different trips made along a transit route. \n\nMy note of caution is that this is a very simplified approach limited to changing the end-to-end travel speed of the line and letting the network router interpolate the intermediate stop times. In the original data, stop times are populated along the entire route and reflect some slower speed segments. That original granularity is lost in this approach and some stations are going to overly benefit in this simulation.\n\nTo change the speeds, we need to read in the late 2025 GTFS files into R and collect all the trips made by Line 6 into a list:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nttc_2025_gtfs <- gtfstools::read_gtfs(fs::path(data_path, \"ttc_2025.zip\"))\n\nfwlrt_trip_ids <- ttc_2025_gtfs |> \n  gtfstools::filter_by_route_id(route_id = \"6\") |> \n  pluck(\"trips\") |> \n  select(trip_id) |> \n  deframe()\n```\n:::\n\n\nWe can confirm Line 6's average speed (in kph) in these GTFS files as:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nttc_2025_gtfs |> \n  gtfstools::get_trip_speed(trip_id = fwlrt_trip_ids) |> \n  summarize(speed = mean(speed)) |> \n  pull(speed)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 13.59186\n```\n\n\n:::\n:::\n\n\nLet's up this to 18kph and write out a new GTFS file to the faster Finch network folder:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nttc_2025_ff_gtfs <- ttc_2025_gtfs |>\n  gtfstools::set_trip_speed(trip_id = fwlrt_trip_ids,\n                            speed = 18,\n                            unit = \"km/h\")\n\ngtfstools::write_gtfs(ttc_2025_ff_gtfs,\n                      path = fs::path(ttc_2025_ff_path, \"ttc_2025_ff.zip\"))\n```\n:::\n\n\nHaving vehicles travel faster down the line is going to mess with the vehicle departure and arrival cadence in the scheduled trips, effectively having vehicles travel down the line faster but then wait at the terminus until the next departure time on the old cadence. Thus while the service is _faster_, more _trips_ are not being made over the 8:00 AM to 9:00 AM time window. \n\nSolving this would require significantly more effort in editing the GTFS files, likely using sketch planning tools outside of R. But as an illustrative analysis, let's go with it to see how the faster travel times and service levels affect access. To do this, we will build the network:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nttc_2025_ff_network <- r5r::build_network(data_path = ttc_2025_ff_path)\n```\n:::\n\n\nAnd re-run the routing analysis with the faster Finch service on the network:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nroute_post_ff_eb <- r5r::detailed_itineraries(\n  r5r_network = ttc_2025_ff_network,\n  origins = humber_point,\n  destinations = finch_west_point,\n  mode = \"transit\",\n  departure_datetime = ymd_hms(\"2025-12-09 08:00:00\"),\n  shortest_path = FALSE\n) |> \n  mutate(scenario = \"faster finch\", direction = \"eastbound\")\n\nroute_post_ff_wb <- r5r::detailed_itineraries(\n  r5r_network = ttc_2025_ff_network,\n  origins = finch_west_point,\n  destinations = humber_point,\n  mode = \"transit\",\n  departure_datetime = ymd_hms(\"2025-12-09 08:00:00\"),\n  shortest_path = FALSE\n) |> \n  mutate(scenario = \"faster finch\", direction = \"westbound\")\n```\n:::\n\n\nCompared to the previous travel times in @tbl-routes, we can see that the 18kph has dropped the end-to-end travel times to about 35 minutes:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nroute_pre_eb |> \n  bind_rows(route_pre_wb, route_post_eb, route_post_wb, route_post_ff_eb, route_post_ff_wb) |> \n  filter(mode != \"WALK\") |> \n  st_drop_geometry() |> \n  select(scenario, direction, mode, segment_duration, route) |> \n  gt::gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"wcsdxpzega\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#wcsdxpzega table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#wcsdxpzega thead, #wcsdxpzega tbody, #wcsdxpzega tfoot, #wcsdxpzega tr, #wcsdxpzega td, #wcsdxpzega th {\n  border-style: none;\n}\n\n#wcsdxpzega p {\n  margin: 0;\n  padding: 0;\n}\n\n#wcsdxpzega .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#wcsdxpzega .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#wcsdxpzega .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#wcsdxpzega .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#wcsdxpzega .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#wcsdxpzega .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wcsdxpzega .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#wcsdxpzega .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#wcsdxpzega .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#wcsdxpzega .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#wcsdxpzega .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#wcsdxpzega .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#wcsdxpzega .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#wcsdxpzega .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#wcsdxpzega .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#wcsdxpzega .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#wcsdxpzega .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#wcsdxpzega .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#wcsdxpzega .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wcsdxpzega .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#wcsdxpzega .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#wcsdxpzega .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#wcsdxpzega .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wcsdxpzega .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#wcsdxpzega .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#wcsdxpzega .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wcsdxpzega .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wcsdxpzega .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#wcsdxpzega .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wcsdxpzega .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#wcsdxpzega .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wcsdxpzega .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#wcsdxpzega .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wcsdxpzega .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#wcsdxpzega .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wcsdxpzega .gt_left {\n  text-align: left;\n}\n\n#wcsdxpzega .gt_center {\n  text-align: center;\n}\n\n#wcsdxpzega .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#wcsdxpzega .gt_font_normal {\n  font-weight: normal;\n}\n\n#wcsdxpzega .gt_font_bold {\n  font-weight: bold;\n}\n\n#wcsdxpzega .gt_font_italic {\n  font-style: italic;\n}\n\n#wcsdxpzega .gt_super {\n  font-size: 65%;\n}\n\n#wcsdxpzega .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#wcsdxpzega .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#wcsdxpzega .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#wcsdxpzega .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#wcsdxpzega .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#wcsdxpzega .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#wcsdxpzega .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#wcsdxpzega .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#wcsdxpzega div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"scenario\">scenario</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"direction\">direction</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"mode\">mode</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"segment_duration\">segment_duration</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"route\">route</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"scenario\" class=\"gt_row gt_left\">pre</td>\n<td headers=\"direction\" class=\"gt_row gt_left\">eastbound</td>\n<td headers=\"mode\" class=\"gt_row gt_left\">BUS</td>\n<td headers=\"segment_duration\" class=\"gt_row gt_right\">44.8</td>\n<td headers=\"route\" class=\"gt_row gt_right\">36</td></tr>\n    <tr><td headers=\"scenario\" class=\"gt_row gt_left\">pre</td>\n<td headers=\"direction\" class=\"gt_row gt_left\">westbound</td>\n<td headers=\"mode\" class=\"gt_row gt_left\">BUS</td>\n<td headers=\"segment_duration\" class=\"gt_row gt_right\">40.3</td>\n<td headers=\"route\" class=\"gt_row gt_right\">36</td></tr>\n    <tr><td headers=\"scenario\" class=\"gt_row gt_left\">post</td>\n<td headers=\"direction\" class=\"gt_row gt_left\">eastbound</td>\n<td headers=\"mode\" class=\"gt_row gt_left\">TRAM</td>\n<td headers=\"segment_duration\" class=\"gt_row gt_right\">46.0</td>\n<td headers=\"route\" class=\"gt_row gt_right\">6</td></tr>\n    <tr><td headers=\"scenario\" class=\"gt_row gt_left\">post</td>\n<td headers=\"direction\" class=\"gt_row gt_left\">westbound</td>\n<td headers=\"mode\" class=\"gt_row gt_left\">TRAM</td>\n<td headers=\"segment_duration\" class=\"gt_row gt_right\">46.0</td>\n<td headers=\"route\" class=\"gt_row gt_right\">6</td></tr>\n    <tr><td headers=\"scenario\" class=\"gt_row gt_left\">faster finch</td>\n<td headers=\"direction\" class=\"gt_row gt_left\">eastbound</td>\n<td headers=\"mode\" class=\"gt_row gt_left\">TRAM</td>\n<td headers=\"segment_duration\" class=\"gt_row gt_right\">34.6</td>\n<td headers=\"route\" class=\"gt_row gt_right\">6</td></tr>\n    <tr><td headers=\"scenario\" class=\"gt_row gt_left\">faster finch</td>\n<td headers=\"direction\" class=\"gt_row gt_left\">westbound</td>\n<td headers=\"mode\" class=\"gt_row gt_left\">TRAM</td>\n<td headers=\"segment_duration\" class=\"gt_row gt_right\">34.6</td>\n<td headers=\"route\" class=\"gt_row gt_right\">6</td></tr>\n  </tbody>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nWhat about changes in accessibility? Let's re-run the post-scenario accessibility analysis using the faster Finch network:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\naccess_post_ff <- r5r::travel_time_matrix(\n  r5r_network = ttc_2025_ff_network,\n  origins = census_data_db_fwlrt |> st_centroid() |> st_transform(crs = 4326),\n  destinations = tts_tazs |> st_centroid() |> st_transform(crs = 4326),\n  mode = \"transit\",\n  departure_datetime = ymd_hms(\"2025-12-09 08:00:00\"),\n  time_window = 60\n) |> \n  left_join(tts_jobs, by = c(\"to_id\" = \"id\")) |>\n  mutate(weighted_jobs = jobs * log_logistic_f(\n    t_ij = travel_time_p50,\n    med_tau = 49,\n    beta = 4.4856\n  )) |>\n  group_by(from_id) |>\n  summarize(access = sum(weighted_jobs)) |>\n  rename(access_post_ff = access)\n```\n:::\n\n\nAnd map the results:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ncensus_data_db_fwlrt_access_ff <- census_data_db_fwlrt_access |> \n  left_join(access_post_ff, by = c(\"id\" = \"from_id\")) |> \n  mutate(\n    access_diff_prepost_ff = ((access_post_ff - access_pre) / access_pre) * 100,\n    access_diff_postpost_ff = ((access_post_ff - access_post) / access_post) * 100\n    ) |> \n  pivot_longer(cols = starts_with(\"access_diff\"), names_to = \"scenario\", values_to = \"access_diff\", names_prefix = \"access_diff_\")\n\ntm_shape(census_data_db, bbox = fwlrt_line_buffer) + tm_polygons(col = \"grey99\", fill = \"grey95\") +\n  tm_shape(census_data_db_fwlrt_access_ff |> filter(scenario != \"postpost_ff\")) +\n  tm_fill(\n    fill = \"access_diff\",\n    fill.free = TRUE,\n    fill.scale = tm_scale_intervals(\n      n = 11,\n      style = \"fisher\",\n      midpoint = 0,\n      values = \"-brewer.rd_bu\"\n    ),\n    fill.legend = tm_legend(\n      title = \"accessibility \\nchange (%)\",\n      frame = FALSE\n    ),\n    fill.chart = tm_chart_histogram()\n  ) +\n  tm_facets_vstack(by = \"scenario\") +\n  tm_shape(existing_rt) + tm_lines(col = \"grey35\", lwd = 4) +\n  tm_shape(fwlrt_line) + tm_lines(col = \"grey\", lwd = 4) +\n  tm_shape(fwlrt_stops) + tm_dots(size = .5, fill = \"grey\") +\n  tm_shape(fwlrt_stops) + tm_dots(size = .15, fill = \"white\") +\n  tm_layout(\n    between.margin = 0.2,\n    panel.label.bg = FALSE,\n    panel.label.frame = FALSE,\n    panel.labels = c(\"original pre-post\", \"pre-post with faster finch\")\n  )\n```\n\n::: {.cell-output-display}\n![Change in accessibility from late 2018 to 2025 by Speed Scenario](index_files/figure-html/fig-prepost_access_change_ff-1.png){#fig-prepost_access_change_ff width=768}\n:::\n:::\n\n\nFrom @fig-prepost_access_change_ff we can see that the change in speed from 13.6kph to 18kph does help to increase accessibility along the line, with only a small number of DBs still negative. \n\nFor the current period only, we can see how the increase in speed increases accessibility to jobs by up to about 20% for some DBs:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ntm_shape(census_data_db, bbox = fwlrt_line_buffer) + tm_polygons(col = \"grey99\", fill = \"grey95\") +\n  tm_shape(census_data_db_fwlrt_access_ff |> filter(scenario == \"postpost_ff\")) +\n  tm_fill(\n    fill = \"access_diff\",\n    # <1>\n    fill.scale = tm_scale_intervals(\n      n = 10,\n      style = \"fisher\",\n      midpoint = 0,\n      values = \"-brewer.rd_bu\" \n    ),\n    fill.legend = tm_legend(\n      title = \"accessibility \\nchange (%)\",\n      frame = FALSE \n    )\n  ) +\n  tm_shape(existing_rt) + tm_lines(col = \"grey35\", lwd = 4) +\n  tm_shape(fwlrt_line) + tm_lines(col = \"grey\", lwd = 4) +\n  tm_shape(fwlrt_stops) + tm_dots(size = .5, fill = \"grey\") +\n  tm_shape(fwlrt_stops) + tm_dots(size = .15, fill = \"white\") \n```\n\n::: {.cell-output-display}\n![Change in accessibility across current and sped up Finch West LRT schedules](index_files/figure-html/fig-postpost_access_change_ff-1.png){#fig-postpost_access_change_ff width=672}\n:::\n:::\n\n\n## Wrap-up\n\nI'm still excited about Finch and hopeful that service speeds and frequencies will ramp up as the line finds its groove. While the raw change in average speed used here indirectly penalizes the line for not running more trips, the results still show what we’d expect: speeding up Finch meaningfully increases access.\n\nBigger picture, Toronto’s surface transit services are often constrained by a transit priority problem -- ineffective transit signal priority and a persistent emphasis on preserving car capacity. If we spend billions on an LRT only to have it run like @fig-balloon, oof. And that’s before we even get to other planning choices like tightly spaced stations (I see you Birchmount–Ionview). Looking forward to testing the “slow transit hypothesis” again if/when the Crosstown opens!\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Surface Transit in Toronto](./img/adopox.jpg){#fig-balloon width=75%}\n:::\n:::\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}